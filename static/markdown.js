// From https://gist.github.com/1343518
// Modified by Hakim to handle Markdown indented with tabs
(function(){if(typeof marked=="undefined")throw"The reveal.js Markdown plugin requires marked to be loaded";var e=function(e){var t=e.querySelector("script"),n=(t||e).textContent,r=n.match(/^\n?(\s*)/)[1].length,i=n.match(/^\n?(\t*)/)[1].length;return i>0?n=n.replace(new RegExp("\\n?\\t{"+i+"}","g"),"\n"):r>1&&(n=n.replace(new RegExp("\\n? {"+r+"}","g"),"\n")),n},t=function(e){return'<script type="text/template">'+e+"</script>"},n=function(e){var t=e.attributes,n=[];for(var r=0,i=t.length;r<i;r++){var s=t[r].name,o=t[r].value;if(/data\-(markdown|separator|vertical)/gi.test(s))continue;o?n.push(s+"="+o):n.push(s)}return n.join(" ")},r=function(e,n,r,i){n=n||"^\n---\n$";var s=new RegExp(n+(r?"|"+r:""),"mg"),o=new RegExp(n),u,a=0,f,l=!0,c,h=[],p="";while(u=s.exec(e))f=o.test(u[0]),!f&&l&&h.push([]),c=e.substring(a,u.index),f&&l?h.push(c):h[h.length-1].push(c),a=s.lastIndex,l=f;(l?h:h[h.length-1]).push(e.substring(a));for(var d=0,v=h.length;d<v;d++)typeof h[d]=="string"?p+="<section "+i+" data-markdown>"+t(h[d])+"</section>":p+="<section "+i+">"+"<section data-markdown>"+h[d].map(t).join("</section><section data-markdown>")+"</section>"+"</section>";return p},i=function(){var t=document.querySelectorAll("[data-markdown]"),i;for(var s=0,o=t.length;s<o;s++){i=t[s];if(i.getAttribute("data-markdown").length){var u=new XMLHttpRequest,a=i.getAttribute("data-markdown");u.onreadystatechange=function(){u.readyState===4&&(u.status>=200&&u.status<300?i.outerHTML=r(u.responseText,i.getAttribute("data-separator"),i.getAttribute("data-vertical"),n(i)):i.outerHTML='<section data-state="alert">ERROR: The attempt to fetch '+a+" failed with the HTTP status "+u.status+". Check your browser's JavaScript console for more details."+"<p>Remember that you need to serve the presentation HTML from a HTTP server and the Markdown file must be there too.</p></section>")},u.open("GET",a,!1);try{u.send()}catch(f){alert("Failed to get the Markdown file "+a+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+f)}}else if(i.getAttribute("data-separator")){var l=e(i);i.outerHTML=r(l,i.getAttribute("data-separator"),i.getAttribute("data-vertical"),n(i))}}},s=function(){var e=document.querySelectorAll("[data-markdown]");for(var t=0,n=e.length;t<n;t++)o(e[t])},o=function(t){var n=t.querySelector("aside.notes"),r=e(t);t.innerHTML=marked(r),n&&t.appendChild(n)};i(),s()})();